# FirnWaterCodesGit
firn water content from temperature and density

Files in the repository are prepared in created in the framework of preparation of the manuscript "Water content of firn at Lomonosovfonna, Svalbard, derived from subsurface temperature measurements" authored by Sergey Marchenko, Ward van Pelt, Rickard Pettersson, Veijo Pohjola and Carleen Reijmer and submitted for review to the Journal of Glaciology.

The files can be grouped as follows:

1) EMPIRICAL DATA
* BHrepr.mat - probability of ice layer occurence derived from video surveys in multiple boreholes. For details see [Marchenko S, Pohjola VA, Pettersson R, van Pelt WJJ, Vega CP, Machguth H, Bøggild CE and Isaksson E (2017) A plot-scale study of firn stratigraphy at lomonosovfonna, Svalbard, using ice cores, borehole video and gpr surveys in 2012/14. Journal of Glaciology, 63(237), 67-78 (doi: 10.1017/jog.2016.118)];

* LF_Temp.mat - subsurface temperature data from Lomonosovfonna, also available at [Marchenko S, Pohjola VA and Pettersson R (2019) Subsurface temperature at Lomonosovfonna, Svalbard, April 2012-2016 (doi: 10.1594/PANGAEA.902613)];

* rho.mat - subsurface density data from Lomonosovfonna, also available at [Marchenko S, Pohjola VA, Pettersson R, van Pelt W, Vega CP and Isaksson E (2019) Density and stratigraphy of firn at Lomonosovfonna derived from shallow cores in 1997-2015 (doi: 10.1594/PANGAEA.902221)];

2) CALCULATED DATASETS
* invK8rho8_gamma10_maskedBC_longP.mat - optimized subsurface density and effective thermal conductivity for Lomonosovfonna. For details see [Marchenko S, Cheng G, Lötstedt P, Pohjola V, Pettersson R, van Pelt W and Reijmer C (2019) Thermal conductivity of firn at Lomonosovfonna, Svalbard, derived from subsurface temperature measurements. The Cryosphere, 13(7), 1843-1859 (doi: 10.5194/tc-13-1843-2019)];

* W_data.mat - dataset including subsurface temperature, density and effective thermal conductivity prepared for further calculations of the firn water content. The data file is generated by the script "water01_input.m";

* W_opt.mat - firn water content calculated using the optimization method. The file is generated by the script "water02_inverse.m";

* W_frwd.mat - firn water content calculated using the "direct" method. The file is generated by the script "water03_forward.m".

3) SCRIPTS
* water01_input.m - load empirical and calculated data, do postprocessing and reformating for further use in firn water content calculations;
* water02_inverse.m - calculate the firn water content using the optimization method;
* water03_forward.m - calculate the firn water content using the "direct" method;
* water04_fig.m - produce figures and numerical values used in the manuscript and supplementary information.

4) FUNCTIONS
* keffcalonne.m, keffcalonne2019.m, keffriche.m and keffsturm.m - density-based parameterizations of the effective thermal conductivity of snow and firn that follow:

[Calonne N, Flin F, Morin S, Lesaffre B, du Roscoat SR and Geindreau C (2011) Numerical and experimental investigations of the effective thermal conductivity of snow. Geophysical Research Letters, 38(23), ISSN 1944-8007 (doi: 10.1029/2011GL049234), l23501]

[Calonne N, Milliancourt L, Burr A, Philip A, Martin CL, Flin F and Geindreau C (2019) Thermal conductivity of snow, firn, and porous ice from 3-d image-based computations. Geophysical Research Letters, 46(22), 13079-13089 (doi: 10.1029/2019GL085228)]

[Riche F and Schneebeli M (2013) Thermal conductivity of snow measured by three independent methods and anisotropy considerations. The Cryosphere, 7(1), 217{227 (doi: 10.5194/tc-7-217-2013)]

[Sturm, M.; Holmgren, J.; König, M. & Morris, K. (1997) The thermal conductivity of seasonal snow, Cambridge University Press, Journal of Glaciology, 43, 26-41]

* Cice.m parameterization of the heat capacity of ice as a function of temperature following [Cuffey K and Paterson W (2010) The physics of glaciers. Academic Press, page 400]

* water00_preprocess.m is used by the script "water01_input.m" and both apps. Preprocesses temperature data.

* frfr.m - calculates the depth of the cold to temperate transition (CTT) basing on the temporal evolution of subsurface temperature profile, depth vector and freezing temperature. CTT is defined as the depth above which the entire profile is subfreezing.

* Tkw.m - forward model simulating the evolution of subsurface temperature based on time vector, depth vector, initial and boundary conditions (measured temperature), density profile, thermal conductivity profile, water mass profile, temperature of water freezing

* bisect_water_mass.m - finds the argument (m) bringing the target function (f) closest to 0. Apart from the function (f) alse needs the initial low (L) and high (H) guesses and tolerance (tol) after reaching which the routine stops.

* dfrfr.m - calculates the sum of differences between depths of simulated and measured CTT bound by the time moments to_s and to_f. The function uses the water mass value (g) for layer number (i) and calls the function Tkw.m returning simulated firn temperature evolution.

* plot_background.m and plot_update.m - can be used in the script "water02_inverse.m" for creating the plot for visualization of the optimization progress and updating it as the routine goes through different guesses of the water mass and different depth layers.


5) APPS
* plotTvst.mlapp - show subsurface temperature measured by different values as a function of time, user can choose the depth range of the sensors data from which is to be shown.
* plotTvsZ.mlapp - show subsurface temperature measured by different values as a function of depth, animation through time is possible.
